# h264编码

h264 编码

# 参考文档
* [H.264编解码原理浅析](https://zhuanlan.zhihu.com/p/158392753)
* [多媒体数据压缩与编码技术](https://wenku.baidu.com/view/b4dcc68c9dc3d5bbfd0a79563c1ec5da51e2d672.html?_wkts_=1702972386532)
* [多媒体技术](https://wenku.baidu.com/view/60c4f40e31126edb6e1a100d?aggId=b4dcc68c9dc3d5bbfd0a79563c1ec5da51e2d672&fr=catalogMain_text_ernie_recall_backup_new%3Awk_recommend_main3&_wkts_=1703060843451)

* 思考
* 思考
* 思考

# 数据压缩的目的

  节省存储空间、传输时间、信号频带或发送能量等

# 压缩原理

  删除冗余的或者不相关的信息，减少数据量的技术  
  数据压缩技术利用了数据固有的冗余性和不相干性，将一个大的数据文件转换成较小的文件  
  由压缩的文件可以在以后需要的时候以精确的或近似的方式将源文件恢复出来  

# 数据冗余类型

* 空间冗余
* 时间冗余
* 信息熵冗余
* 视觉冗余
* 听觉冗余
* 其它冗余  
    结构冗余  
    知识冗余  
* 图像区域的相同性冗余
* 纹理的统计冗余

# 无损压缩

利用数据的统计冗余进行压缩，可完全恢复原始数据而不引入任何失真，但压缩率受到统计冗余度的理论限制一般为2：1到5：1


# 视频编码原因

* 空间冗余 比如说将一帧图像划分成一个个 16x16 的块之后，相邻的块很多时候都有比较明显的相似性，这种就叫空间冗余。 
* 时间冗余 一个帧率为 25fps 的视频中前后两帧图像相差只有 40ms，两张图像的变化是比较小的，相似性很高，这种叫做时间冗余   
* 视觉冗余 我们的眼睛是有视觉灵敏度这个东西的。人的眼睛对于图像中高频信息的敏感度是小于低频信息的。有的时候去除图像中的一些高频信息，人眼看起来跟不去除高频信息差别不大，这种叫做视觉冗余。 
* 信息熵冗余 我们一般会使用 Zip 等压缩工具去压缩文件，将文件大小减小，这个对于图像来说也是可以做的，这种冗余叫做信息熵冗余。

视频编码就是通过减少上述 4 种冗余来达到压缩视频的目的。

# 视频压缩

* 帧内预测压缩，解决的是空间数据冗余问题
* 帧间预测压缩（运动估计与补偿），解决的是时域数据冗徐问题。
* 

# VCL & NAL

VCL（Video Coding Layer） 包括核心压缩引擎和块、宏块和片的语法级别定义，设计目标是尽可能地独立于网络进行高效的编码
NAL（Network Abstraction Layer）负责将 VCL 产生的比特字符串适配到各种各样的网络和多元环境中，覆盖了所有片级以上的语法级别




# 视频编码

视频编码分为五个模块（如下图），帧类型分析、帧内/帧间预测、变换+量化、滤波、熵编码。

* 帧类型分析
  
* 帧内/帧间预测
  
  帧间预测的话，编码器会以当前块空域相邻的位置，在时域参考帧上的同为块，作为起始点进行规则搜索，直到搜索完找到能够节省码流最大的块作为帧间预测块，当前块到预测块的位移称为运动矢量，这样我们在码流中传输运动矢量、帧间预测模式标志位、残差就可以

* 变换+量化

* 滤波