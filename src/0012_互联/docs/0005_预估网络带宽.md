# 预估网络带宽

预估网络带宽

# 参考文档

* [10｜带宽预测：3大算法准确预估网络带宽](https://time.geekbang.org/column/article/467073)
* [WebRTC带宽估计](https://blog.csdn.net/beginning1126/article/details/115276534)
* [webrtc QOS方法四.3(probe探测算法学习)](https://blog.csdn.net/CrystalShaw/article/details/118530699)
WebRTC系列分享 第五期 | WebRTC QoS方法之Sender Side BWE实现 
# 带宽预测

  带宽预测，顾名思义，就是实时预测当前的网络带宽大小。预测出实际的带宽之后，我们就可以控制音视频数据的发送数据量。

  * 计算一组 RTP 包的发送时长和接收时长，并计算延时
  * 需要根据当前延时和历史延时的大小来计算延时变化的趋势
  * 根据延时变化趋势判断网络状况；
  * 根据网络状况调整更新预测带宽值。


# 基于丢包的带宽预测算法


# 最大带宽探测算法

* 发送端设定一个探测的目标带宽，一般设置为当前带宽的 2 倍、3 倍或者 6 倍
* 接收端并不关注当前包是不是探测包，而是直接统计每一个包的序号和接收时间，将统计结果组成 Transport-CC 报文反馈给发送端。
* 发送端接收到 Transport-CC 报文之后，会看报文中的每一个包是不是探测包，如果是探测包，就从发送端发送的历史数据中，取出其 cluster_id 和发送时间，并且从 Transport-CC 报文中得到接收时间，再把这些信息送入到探测带宽计算器中，当探测带宽计算器中相同 cluster_id 的 RTP 包信息数量达到一定值之后，就可以计算最终探测到的带宽值了

    首先，根据发送的探测 RTP 包总大小，和探测 RTP 包的总发送时间，相除就得到了发送端的最大带宽值了  
    然后，再根据接收端接收到的探测 RTP 包总大小，和探测 RTP 包的总接收时间，相除就得到了接收端的最大带宽值了  
    之后，取两者中的最小值作为探测到的网络最大带宽值。同时，如果接收端的最大带宽小于 0.9 倍的发送带宽，说明当前探测目标带宽已经到了最大带宽了，为了保险一些，最后将最大带宽取为接收端最大带宽的 0.95 倍。  
    如果当前过载检测器检测不是在过载状态的话，预估带宽值更新为探测到的最大带宽值。


* 如果我们当前视频处于静止画面的状态，发送的码率会很小。这样预估带宽就很难从一个比较小的带宽调整上去。如果此时画面突然动起来，即便实际网络带宽足够，还是会因为预估带宽不够而限制发送码率，从而导致画面出现模糊和马赛克等问题

* 思考
* 思考
* 思考
